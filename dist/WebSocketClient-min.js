"use strict";function Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function EventEmitter(){this._events=new Events,this._eventsCount=0}var has=Object.prototype.hasOwnProperty,prefix="~";Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)has.call(e,t)&&n.push(prefix?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},EventEmitter.prototype.listeners=function(e,t){var n=prefix?prefix+e:e,s=this._events[n];if(t)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var o=0,i=s.length,r=new Array(i);o<i;o++)r[o]=s[o].fn;return r},EventEmitter.prototype.emit=function(e,t,n,s,o,i){var r=prefix?prefix+e:e;if(!this._events[r])return!1;var c,a,l=this._events[r],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,s),!0;case 5:return l.fn.call(l.context,t,n,s,o),!0;case 6:return l.fn.call(l.context,t,n,s,o,i),!0}for(a=1,c=new Array(h-1);a<h;a++)c[a-1]=arguments[a];l.fn.apply(l.context,c)}else{var p,f=l.length;for(a=0;a<f;a++)switch(l[a].once&&this.removeListener(e,l[a].fn,void 0,!0),h){case 1:l[a].fn.call(l[a].context);break;case 2:l[a].fn.call(l[a].context,t);break;case 3:l[a].fn.call(l[a].context,t,n);break;case 4:l[a].fn.call(l[a].context,t,n,s);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];l[a].fn.apply(l[a].context,c)}}return!0},EventEmitter.prototype.on=function(e,t,n){var s=new EE(t,n||this),o=prefix?prefix+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],s]:this._events[o].push(s):(this._events[o]=s,this._eventsCount++),this},EventEmitter.prototype.once=function(e,t,n){var s=new EE(t,n||this,(!0)),o=prefix?prefix+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],s]:this._events[o].push(s):(this._events[o]=s,this._eventsCount++),this},EventEmitter.prototype.removeListener=function(e,t,n,s){var o=prefix?prefix+e:e;if(!this._events[o])return this;if(!t)return 0===--this._eventsCount?this._events=new Events:delete this._events[o],this;var i=this._events[o];if(i.fn)i.fn!==t||s&&!i.once||n&&i.context!==n||(0===--this._eventsCount?this._events=new Events:delete this._events[o]);else{for(var r=0,c=[],a=i.length;r<a;r++)(i[r].fn!==t||s&&!i[r].once||n&&i[r].context!==n)&&c.push(i[r]);c.length?this._events[o]=1===c.length?c[0]:c:0===--this._eventsCount?this._events=new Events:delete this._events[o]}return this},EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=prefix?prefix+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new Events:delete this._events[t])):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,"undefined"!=typeof module&&(module.exports=EventEmitter);var WebSocketClient=function(){EventEmitter.call(this),this.number=0,this.attempts=1,this.instance=null};WebSocketClient.prototype=Object.create(EventEmitter.prototype),WebSocketClient.prototype.constructor=WebSocketClient,WebSocketClient.prototype.close=function(){this.instance&&this.instance.close&&(this.instance.close(),this.instance.onopen=null,this.instance.onmessage=null,this.instance.onclose=null,this.instance.onerror=null,this.instance=null)},WebSocketClient.prototype.connect=function(e){var t=this;this.url=e,this.instance=new WebSocket(this.url),this.instance.onopen=function(){t.attempts=1,t.instance.binaryType="arraybuffer",t.instance.onmessage=function(e){console.debug("onmessage",t),t.emit("data",e.data),t.number++,t.onmessage(e)},t.onopen()},this.instance.onclose=function(e){switch(e.code){case 1e3:console.debug("WebSocket: closed");break;default:t.reconnect.bind(t)(e)}t.onclose(e)},this.instance.onerror=function(e){switch(e.code){case"ECONNREFUSED":t.reconnect.bind(t)(e);break;default:t.onerror(e)}}},WebSocketClient.prototype.send=function(e){try{this.instance.send(e)}catch(e){this.instance.emit("error",e)}},WebSocketClient.prototype.reconnect=function(e){function t(e){return 1e3*Math.min(30,Math.pow(2,e)-1)}var n=this,s=t(n.attempts);console.debug("WebSocketClient: retry in "+s+"ms",e),setTimeout(function(){n.attempts++,console.debug("WebSocketClient: reconnecting..."+n.attempts),n.connect(n.url)},s)},WebSocketClient.prototype.onopen=function(){console.debug("WebSocketClient: open",arguments)},WebSocketClient.prototype.onerror=function(e){console.debug("WebSocketClient: error",e)},WebSocketClient.prototype.onmessage=function(e){console.debug("WebSocketClient: message",e.data.length)},WebSocketClient.prototype.onclose=function(e){console.debug("WebSocketClient: closed",e.code)};