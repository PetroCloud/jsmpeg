var BitReader=function(t){this.bytes=new Uint8Array(t),this.length=this.bytes.length,this.writePos=this.bytes.length,this.index=0};BitReader.NOT_FOUND=-1,BitReader.prototype.findNextMPEGStartCode=function(){for(var t=this.index+7>>3;t<this.writePos;t++)if(0===this.bytes[t]&&0===this.bytes[t+1]&&1===this.bytes[t+2])return this.index=t+4<<3,this.bytes[t+3];return this.index=this.writePos<<3,BitReader.NOT_FOUND},BitReader.prototype.nextBytesAreStartCode=function(){var t=this.index+7>>3;return t>=this.writePos||0===this.bytes[t]&&0===this.bytes[t+1]&&1===this.bytes[t+2]},BitReader.prototype.nextBits=function(t){var e=this.index>>3,r=8-this.index%8;if(r>=t)return this.bytes[e]>>r-t&255>>8-t;var i=(this.index+t)%8,o=this.index+t-1>>3,s=this.bytes[e]&255>>8-r;for(e++;e<o;e++)s<<=8,s|=this.bytes[e];return i>0?(s<<=i,s|=this.bytes[e]>>8-i):(s<<=8,s|=this.bytes[e]),s},BitReader.prototype.getBits=function(t){var e=this.nextBits(t);return this.index+=t,e},BitReader.prototype.advance=function(t){return this.index+=t},BitReader.prototype.rewind=function(t){return this.index-=t};var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),jsmpeglive=function(t){t=t||{},this.canvas=t.canvas||document.createElement("canvas"),this.externalDecodeCallback=t.ondecodeframe||null,!t.forceCanvas2D&&this.initWebGL()?this.renderFrame=this.renderFrameGL:(this.canvasContext=this.canvas.getContext("2d"),this.renderFrame=this.renderFrame2D),this.blockData=new Int32Array(64),this.zeroBlockData=new Int32Array(64),this.fillArray(this.zeroBlockData,0),this.buffer=new BitReader(new ArrayBuffer(this.socketBufferSize)),this.nextPictureBuffer=new BitReader(new ArrayBuffer(this.socketBufferSize)),this.nextPictureBuffer.writePos=0,this.nextPictureBuffer.chunkBegin=0,this.nextPictureBuffer.lastWriteBeforeWrap=0};jsmpeglive.prototype.waitForIntraFrame=!0,jsmpeglive.prototype.socketBufferSize=524288,jsmpeglive.prototype.decodeHeader=function(t){t[0]===SOCKET_MAGIC_BYTES.charCodeAt(0)&&t[1]===SOCKET_MAGIC_BYTES.charCodeAt(1)&&t[2]===SOCKET_MAGIC_BYTES.charCodeAt(2)&&t[3]===SOCKET_MAGIC_BYTES.charCodeAt(3)&&(this.width=256*t[4]+t[5],this.height=256*t[6]+t[7],this.initBuffers())},jsmpeglive.prototype.render=function(t){var e=new Uint8Array(t);this.sequenceStarted||this.decodeHeader(e);var r=this.buffer,i=this.nextPictureBuffer;i.writePos+e.length>i.length&&(i.lastWriteBeforeWrap=i.writePos,i.writePos=0,i.index=0),i.bytes.set(e,i.writePos),i.writePos+=e.length;for(var o;;){if(o=i.findNextMPEGStartCode(),o===BitReader.NOT_FOUND||i.index>>3>i.writePos)return void(i.index=Math.max(i.writePos-3,0)<<3);if(o===START_PICTURE)break}if(this.waitForIntraFrame)return i.advance(10),void(i.getBits(3)===PICTURE_TYPE_I&&(this.waitForIntraFrame=!1,i.chunkBegin=i.index-13>>3));this.currentPictureDecoded||this.decodePicture(DECODE_SKIP_OUTPUT);var s=i.index>>3;if(s>i.chunkBegin)r.bytes.set(i.bytes.subarray(i.chunkBegin,s)),r.writePos=s-i.chunkBegin;else{r.bytes.set(i.bytes.subarray(i.chunkBegin,i.lastWriteBeforeWrap));var h=i.lastWriteBeforeWrap-i.chunkBegin;r.bytes.set(i.bytes.subarray(0,s),h),r.writePos=s+h}r.index=0,i.chunkBegin=s,this.currentPictureDecoded=!1,requestAnimFrame(this.scheduleDecoding.bind(this),this.canvas)},jsmpeglive.prototype.scheduleDecoding=function(){this.decodePicture(),this.currentPictureDecoded=!0},jsmpeglive.prototype.readCode=function(t){var e=0;do e=t[e+this.buffer.getBits(1)];while(e>=0&&0!==t[e]);return t[e+2]},jsmpeglive.prototype.fillArray=function(t,e){for(var r=0,i=t.length;r<i;r++)t[r]=e},jsmpeglive.prototype.pictureRate=30,jsmpeglive.prototype.initBuffers=function(){if(this.intraQuantMatrix=DEFAULT_INTRA_QUANT_MATRIX,this.nonIntraQuantMatrix=DEFAULT_NON_INTRA_QUANT_MATRIX,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.quarterSize=this.codedSize>>2,!this.sequenceStarted){this.sequenceStarted=!0;var t=window.Uint8ClampedArray||window.Uint8Array;window.Uint8ClampedArray||(this.copyBlockToDestination=this.copyBlockToDestinationClamp,this.addBlockToDestination=this.addBlockToDestinationClamp),this.currentY=new t(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new t(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new t(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new t(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new t(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new t(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer),this.canvas.width=this.width,this.canvas.height=this.height,this.gl?(this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)):(this.currentRGBA=this.canvasContext.getImageData(0,0,this.width,this.height),this.fillArray(this.currentRGBA.data,255))}},jsmpeglive.prototype.currentY=null,jsmpeglive.prototype.currentCr=null,jsmpeglive.prototype.currentCb=null,jsmpeglive.prototype.currentRGBA=null,jsmpeglive.prototype.pictureCodingType=0,jsmpeglive.prototype.forwardY=null,jsmpeglive.prototype.forwardCr=null,jsmpeglive.prototype.forwardCb=null,jsmpeglive.prototype.fullPelForward=!1,jsmpeglive.prototype.forwardFCode=0,jsmpeglive.prototype.forwardRSize=0,jsmpeglive.prototype.forwardF=0,jsmpeglive.prototype.currentFrame=-1,jsmpeglive.prototype.currentTime=0,jsmpeglive.prototype.decodePicture=function(t){if(this.currentFrame++,this.currentTime=this.currentFrame/this.pictureRate,this.buffer.advance(10),this.pictureCodingType=this.buffer.getBits(3),this.buffer.advance(16),!(this.pictureCodingType<=0||this.pictureCodingType>=PICTURE_TYPE_B)){if(this.pictureCodingType===PICTURE_TYPE_P){if(this.fullPelForward=this.buffer.getBits(1),this.forwardFCode=this.buffer.getBits(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}var e=0;do e=this.buffer.findNextMPEGStartCode();while(e===START_EXTENSION||e===START_USER_DATA);for(;e>=START_SLICE_FIRST&&e<=START_SLICE_LAST;)this.decodeSlice(255&e),e=this.buffer.findNextMPEGStartCode();if(this.buffer.rewind(32),t!==DECODE_SKIP_OUTPUT&&(this.renderFrame(),this.externalDecodeCallback&&this.externalDecodeCallback(this,this.canvas)),this.pictureCodingType===PICTURE_TYPE_I||this.pictureCodingType===PICTURE_TYPE_P){var r=this.forwardY,i=this.forwardY32,o=this.forwardCr,s=this.forwardCr32,h=this.forwardCb,a=this.forwardCb32;this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=r,this.currentY32=i,this.currentCr=o,this.currentCr32=s,this.currentCb=h,this.currentCb32=a}}},jsmpeglive.prototype.YCbCrToRGBA=function(){for(var t,e,r,i,o,s=this.currentY,h=this.currentCb,a=this.currentCr,n=this.currentRGBA.data,d=0,c=this.codedWidth,f=this.codedWidth+(this.codedWidth-this.width),l=0,u=this.halfWidth-(this.width>>1),p=0,m=4*this.width,T=4*this.width,C=this.width>>1,b=this.height>>1,w=0;w<b;w++){for(var g=0;g<C;g++){t=h[l],e=a[l],l++,r=e+(103*e>>8)-179,i=(88*t>>8)-44+(183*e>>8)-91,o=t+(198*t>>8)-227;var E=s[d++],A=s[d++];n[p]=E+r,n[p+1]=E-i,n[p+2]=E+o,n[p+4]=A+r,n[p+5]=A-i,n[p+6]=A+o,p+=8;var v=s[c++],R=s[c++];n[m]=v+r,n[m+1]=v-i,n[m+2]=v+o,n[m+4]=R+r,n[m+5]=R-i,n[m+6]=R+o,m+=8}d+=f,c+=f,p+=T,m+=T,l+=u}},jsmpeglive.prototype.renderFrame2D=function(){this.YCbCrToRGBA(),this.canvasContext.putImageData(this.currentRGBA,0,0)},jsmpeglive.prototype.gl=null,jsmpeglive.prototype.program=null,jsmpeglive.prototype.YTexture=null,jsmpeglive.prototype.CBTexture=null,jsmpeglive.prototype.CRTexture=null,jsmpeglive.prototype.createTexture=function(t,e){var r=this.gl,i=r.createTexture();return r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.uniform1i(r.getUniformLocation(this.program,e),t),i},jsmpeglive.prototype.compileShader=function(t,e){var r=this.gl,i=r.createShader(t);if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(i));return i},jsmpeglive.prototype.initWebGL=function(){var t;try{t=this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl")}catch(t){return!1}if(!t)return!1;if(this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.program=t.createProgram(),t.attachShader(this.program,this.compileShader(t.VERTEX_SHADER,SHADER_VERTEX_IDENTITY)),t.attachShader(this.program,this.compileShader(t.FRAGMENT_SHADER,SHADER_FRAGMENT_YCBCRTORGBA)),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(this.program));t.useProgram(this.program),this.YTexture=this.createTexture(0,"YTexture"),this.CBTexture=this.createTexture(1,"CBTexture"),this.CRTexture=this.createTexture(2,"CRTexture");var e=t.getAttribLocation(this.program,"vertex");return t.enableVertexAttribArray(e),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),this.loadingProgram=t.createProgram(),t.attachShader(this.loadingProgram,this.compileShader(t.VERTEX_SHADER,SHADER_VERTEX_IDENTITY)),t.attachShader(this.loadingProgram,this.compileShader(t.FRAGMENT_SHADER,SHADER_FRAGMENT_LOADING)),t.linkProgram(this.loadingProgram),t.useProgram(this.loadingProgram),e=t.getAttribLocation(this.loadingProgram,"vertex"),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,2,t.FLOAT,!1,0,0),!0},jsmpeglive.prototype.renderFrameGL=function(){var t=this.gl,e=new Uint8Array(this.currentY.buffer),r=new Uint8Array(this.currentCr.buffer),i=new Uint8Array(this.currentCb.buffer);t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.YTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,this.codedWidth,this.height,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.CBTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,this.halfWidth,this.height/2,0,t.LUMINANCE,t.UNSIGNED_BYTE,r),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.CRTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,this.halfWidth,this.height/2,0,t.LUMINANCE,t.UNSIGNED_BYTE,i),t.drawArrays(t.TRIANGLE_STRIP,0,4)},jsmpeglive.prototype.quantizerScale=0,jsmpeglive.prototype.sliceBegin=!1,jsmpeglive.prototype.decodeSlice=function(t){for(this.sliceBegin=!0,this.macroblockAddress=(t-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.buffer.getBits(5);this.buffer.getBits(1);)this.buffer.advance(8);do this.decodeMacroblock();while(!this.buffer.nextBytesAreStartCode())},jsmpeglive.prototype.macroblockAddress=0,jsmpeglive.prototype.mbRow=0,jsmpeglive.prototype.mbCol=0,jsmpeglive.prototype.macroblockType=0,jsmpeglive.prototype.macroblockIntra=!1,jsmpeglive.prototype.macroblockMotFw=!1,jsmpeglive.prototype.motionFwH=0,jsmpeglive.prototype.motionFwV=0,jsmpeglive.prototype.motionFwHPrev=0,jsmpeglive.prototype.motionFwVPrev=0,jsmpeglive.prototype.decodeMacroblock=function(){for(var t=0,e=this.readCode(MACROBLOCK_ADDRESS_INCREMENT);34===e;)e=this.readCode(MACROBLOCK_ADDRESS_INCREMENT);for(;35===e;)t+=33,e=this.readCode(MACROBLOCK_ADDRESS_INCREMENT);if(t+=e,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=t;else{if(this.macroblockAddress+t>=this.mbSize)return;for(t>1&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureCodingType===PICTURE_TYPE_P&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));t>1;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),t--;this.macroblockAddress++}this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.macroblockType=this.readCode(MACROBLOCK_TYPE_TABLES[this.pictureCodingType]),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!==(16&this.macroblockType)&&(this.quantizerScale=this.buffer.getBits(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb));for(var r=0!==(2&this.macroblockType)?this.readCode(CODE_BLOCK_PATTERN):this.macroblockIntra?63:0,i=0,o=32;i<6;i++)0!==(r&o)&&this.decodeBlock(i),o>>=1},jsmpeglive.prototype.decodeMotionVectors=function(){var t,e,r=0;this.macroblockMotFw?(t=this.readCode(MOTION),0!==t&&1!==this.forwardF?(r=this.buffer.getBits(this.forwardRSize),e=(Math.abs(t)-1<<this.forwardRSize)+r+1,t<0&&(e=-e)):e=t,this.motionFwHPrev+=e,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),t=this.readCode(MOTION),0!==t&&1!==this.forwardF?(r=this.buffer.getBits(this.forwardRSize),e=(Math.abs(t)-1<<this.forwardRSize)+r+1,t<0&&(e=-e)):e=t,this.motionFwVPrev+=e,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureCodingType===PICTURE_TYPE_P&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},jsmpeglive.prototype.copyMacroblock=function(t,e,r,i,o){var s,h,a,n,d,c,f,l,u,p=this.currentY32,m=this.currentCb32,T=this.currentCr32;s=this.codedWidth,h=s-16,a=t>>1,n=e>>1,d=1===(1&t),c=1===(1&e),f=((this.mbRow<<4)+n)*s+(this.mbCol<<4)+a,l=this.mbRow*s+this.mbCol<<2,u=l+(s<<2);var C,b,w,g;if(d)if(c)for(;l<u;){for(b=r[f]+r[f+s],f++,C=0;C<4;C++)w=r[f]+r[f+s],f++,g=b+w+2>>2&255,b=r[f]+r[f+s],f++,g|=b+w+2<<6&65280,w=r[f]+r[f+s],f++,g|=b+w+2<<14&16711680,b=r[f]+r[f+s],f++,g|=b+w+2<<22&4278190080,p[l++]=g;l+=h>>2,f+=h-1}else for(;l<u;){for(b=r[f++],C=0;C<4;C++)w=r[f++],g=b+w+1>>1&255,b=r[f++],g|=b+w+1<<7&65280,w=r[f++],g|=b+w+1<<15&16711680,b=r[f++],g|=b+w+1<<23&4278190080,p[l++]=g;l+=h>>2,f+=h-1}else if(c)for(;l<u;){for(C=0;C<4;C++)g=r[f]+r[f+s]+1>>1&255,f++,g|=r[f]+r[f+s]+1<<7&65280,f++,g|=r[f]+r[f+s]+1<<15&16711680,f++,g|=r[f]+r[f+s]+1<<23&4278190080,f++,p[l++]=g;l+=h>>2,f+=h}else for(;l<u;){for(C=0;C<4;C++)g=r[f],f++,g|=r[f]<<8,f++,g|=r[f]<<16,f++,g|=r[f]<<24,f++,p[l++]=g;l+=h>>2,f+=h}s=this.halfWidth,h=s-8,a=t/2>>1,n=e/2>>1,d=1===(t/2&1),c=1===(e/2&1),f=((this.mbRow<<3)+n)*s+(this.mbCol<<3)+a,l=this.mbRow*s+this.mbCol<<1,u=l+(s<<1);var E,A,v,R,_,y;if(d)if(c)for(;l<u;){for(E=i[f]+i[f+s],R=o[f]+o[f+s],f++,C=0;C<2;C++)A=i[f]+i[f+s],_=o[f]+o[f+s],f++,v=E+A+2>>2&255,y=R+_+2>>2&255,E=i[f]+i[f+s],R=o[f]+o[f+s],f++,v|=E+A+2<<6&65280,y|=R+_+2<<6&65280,A=i[f]+i[f+s],_=o[f]+o[f+s],f++,v|=E+A+2<<14&16711680,y|=R+_+2<<14&16711680,E=i[f]+i[f+s],R=o[f]+o[f+s],f++,v|=E+A+2<<22&4278190080,y|=R+_+2<<22&4278190080,T[l]=v,m[l]=y,l++;l+=h>>2,f+=h-1}else for(;l<u;){for(E=i[f],R=o[f],f++,C=0;C<2;C++)A=i[f],_=o[f++],v=E+A+1>>1&255,y=R+_+1>>1&255,E=i[f],R=o[f++],v|=E+A+1<<7&65280,y|=R+_+1<<7&65280,A=i[f],_=o[f++],v|=E+A+1<<15&16711680,y|=R+_+1<<15&16711680,E=i[f],R=o[f++],v|=E+A+1<<23&4278190080,y|=R+_+1<<23&4278190080,T[l]=v,m[l]=y,l++;l+=h>>2,f+=h-1}else if(c)for(;l<u;){for(C=0;C<2;C++)v=i[f]+i[f+s]+1>>1&255,y=o[f]+o[f+s]+1>>1&255,f++,v|=i[f]+i[f+s]+1<<7&65280,y|=o[f]+o[f+s]+1<<7&65280,f++,v|=i[f]+i[f+s]+1<<15&16711680,y|=o[f]+o[f+s]+1<<15&16711680,f++,v|=i[f]+i[f+s]+1<<23&4278190080,y|=o[f]+o[f+s]+1<<23&4278190080,f++,T[l]=v,m[l]=y,l++;l+=h>>2,f+=h}else for(;l<u;){for(C=0;C<2;C++)v=i[f],y=o[f],f++,v|=i[f]<<8,y|=o[f]<<8,f++,v|=i[f]<<16,y|=o[f]<<16,f++,v|=i[f]<<24,y|=o[f]<<24,f++,T[l]=v,m[l]=y,l++;l+=h>>2,f+=h}},jsmpeglive.prototype.blockData=null,jsmpeglive.prototype.decodeBlock=function(t){var e,r=0;if(this.macroblockIntra){var i,o;if(t<4?(i=this.dcPredictorY,o=this.readCode(DCT_DC_SIZE_LUMINANCE)):(i=4===t?this.dcPredictorCr:this.dcPredictorCb,o=this.readCode(DCT_DC_SIZE_CHROMINANCE)),o>0){var s=this.buffer.getBits(o);0!==(s&1<<o-1)?this.blockData[0]=i+s:this.blockData[0]=i+(-1<<o|s+1)}else this.blockData[0]=i;t<4?this.dcPredictorY=this.blockData[0]:4===t?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,e=this.intraQuantMatrix,r=1}else e=this.nonIntraQuantMatrix;for(var h=0;;){var a=0,n=this.readCode(DCT_COEFF);if(1===n&&r>0&&0===this.buffer.getBits(1))break;65535===n?(a=this.buffer.getBits(6),h=this.buffer.getBits(8),0===h?h=this.buffer.getBits(8):128===h?h=this.buffer.getBits(8)-256:h>128&&(h-=256)):(a=n>>8,h=255&n,this.buffer.getBits(1)&&(h=-h)),r+=a;var d=ZIG_ZAG[r];r++,h<<=1,this.macroblockIntra||(h+=h<0?-1:1),h=h*this.quantizerScale*e[d]>>4,0===(1&h)&&(h-=h>0?1:-1),h>2047?h=2047:h<-2048&&(h=-2048),this.blockData[d]=h*PREMULTIPLIER_MATRIX[d]}var c,f,l;t<4?(c=this.currentY,l=this.codedWidth-8,f=this.mbRow*this.codedWidth+this.mbCol<<4,0!==(1&t)&&(f+=8),0!==(2&t)&&(f+=this.codedWidth<<3)):(c=4===t?this.currentCb:this.currentCr,l=(this.codedWidth>>1)-8,f=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===r?(this.copyValueToDestination(this.blockData[0]+128>>8,c,f,l),this.blockData[0]=0):(this.IDCT(),this.copyBlockToDestination(this.blockData,c,f,l),this.blockData.set(this.zeroBlockData)):1===r?(this.addValueToDestination(this.blockData[0]+128>>8,c,f,l),this.blockData[0]=0):(this.IDCT(),this.addBlockToDestination(this.blockData,c,f,l),this.blockData.set(this.zeroBlockData)),r=0},jsmpeglive.prototype.copyBlockToDestination=function(t,e,r,i){for(var o=0;o<64;o+=8,r+=i+8)e[r+0]=t[o],e[r+1]=t[o+1],e[r+2]=t[o+2],e[r+3]=t[o+3],e[r+4]=t[o+4],e[r+5]=t[o+5],e[r+6]=t[o+6],e[r+7]=t[o+7]},jsmpeglive.prototype.addBlockToDestination=function(t,e,r,i){for(var o=0;o<64;o+=8,r+=i+8)e[r+0]+=t[o],e[r+1]+=t[o+1],e[r+2]+=t[o+2],e[r+3]+=t[o+3],e[r+4]+=t[o+4],e[r+5]+=t[o+5],e[r+6]+=t[o+6],e[r+7]+=t[o+7]},jsmpeglive.prototype.copyValueToDestination=function(t,e,r,i){for(var o=0;o<64;o+=8,r+=i+8)e[r+0]=t,e[r+1]=t,e[r+2]=t,e[r+3]=t,e[r+4]=t,e[r+5]=t,e[r+6]=t,e[r+7]=t},jsmpeglive.prototype.addValueToDestination=function(t,e,r,i){for(var o=0;o<64;o+=8,r+=i+8)e[r+0]+=t,e[r+1]+=t,e[r+2]+=t,e[r+3]+=t,e[r+4]+=t,e[r+5]+=t,e[r+6]+=t,e[r+7]+=t},jsmpeglive.prototype.copyBlockToDestinationClamp=function(t,e,r,i){for(var o=0,s=0;s<8;s++){for(var h=0;h<8;h++){var a=t[o++];e[r++]=a>255?255:a<0?0:a}r+=i}},jsmpeglive.prototype.addBlockToDestinationClamp=function(t,e,r,i){for(var o=0,s=0;s<8;s++){for(var h=0;h<8;h++){var a=t[o++]+e[r];e[r++]=a>255?255:a<0?0:a}r+=i}},jsmpeglive.prototype.IDCT=function(){var t,e,r,i,o,s,h,a,n,d,c,f,l,u,p,m,T,C,b,w=this.blockData;for(b=0;b<8;++b)t=w[32+b],e=w[16+b]+w[48+b],r=w[40+b]-w[24+b],s=w[8+b]+w[56+b],h=w[24+b]+w[40+b],i=w[8+b]-w[56+b],o=s+h,a=w[b],l=(473*i-196*r+128>>8)-o,n=l-(362*(s-h)+128>>8),d=a-t,c=(362*(w[16+b]-w[48+b])+128>>8)-e,f=a+t,u=d+c,p=f+e,m=d-c,T=f-e,C=-n-(473*r+196*i+128>>8),w[b]=o+p,w[8+b]=l+u,w[16+b]=m-n,w[24+b]=T-C,w[32+b]=T+C,w[40+b]=n+m,w[48+b]=u-l,w[56+b]=p-o;for(b=0;b<64;b+=8)t=w[4+b],e=w[2+b]+w[6+b],r=w[5+b]-w[3+b],s=w[1+b]+w[7+b],h=w[3+b]+w[5+b],i=w[1+b]-w[7+b],o=s+h,a=w[b],l=(473*i-196*r+128>>8)-o,n=l-(362*(s-h)+128>>8),d=a-t,c=(362*(w[2+b]-w[6+b])+128>>8)-e,f=a+t,u=d+c,p=f+e,m=d-c,T=f-e,C=-n-(473*r+196*i+128>>8),w[b]=o+p+128>>8,w[1+b]=l+u+128>>8,w[2+b]=m-n+128>>8,w[3+b]=T-C+128>>8,w[4+b]=T+C+128>>8,w[5+b]=n+m+128>>8,w[6+b]=u-l+128>>8,w[7+b]=p-o+128>>8};var SOCKET_MAGIC_BYTES="jsmp",DECODE_SKIP_OUTPUT=1,ZIG_ZAG=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),DEFAULT_INTRA_QUANT_MATRIX=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),DEFAULT_NON_INTRA_QUANT_MATRIX=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),PREMULTIPLIER_MATRIX=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),MACROBLOCK_ADDRESS_INCREMENT=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),MACROBLOCK_TYPE_I=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),MACROBLOCK_TYPE_P=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),MACROBLOCK_TYPE_B=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),CODE_BLOCK_PATTERN=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),MOTION=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),DCT_DC_SIZE_LUMINANCE=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),DCT_DC_SIZE_CHROMINANCE=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),DCT_COEFF=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),PICTURE_TYPE_I=1,PICTURE_TYPE_P=2,PICTURE_TYPE_B=3,START_SLICE_FIRST=1,START_SLICE_LAST=175,START_PICTURE=0,START_EXTENSION=181,START_USER_DATA=178,SHADER_FRAGMENT_YCBCRTORGBA=["precision mediump float;","uniform sampler2D YTexture;","uniform sampler2D CBTexture;","uniform sampler2D CRTexture;","varying vec2 texCoord;","void main() {","float y = texture2D(YTexture, texCoord).r;","float cr = texture2D(CBTexture, texCoord).r - 0.5;","float cb = texture2D(CRTexture, texCoord).r - 0.5;","gl_FragColor = vec4(","y + 1.4 * cr,","y + -0.343 * cb - 0.711 * cr,","y + 1.765 * cb,","1.0",");","}"].join("\n"),SHADER_FRAGMENT_LOADING=["precision mediump float;","uniform float loaded;","varying vec2 texCoord;","void main() {","float c = ceil(loaded-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),SHADER_VERTEX_IDENTITY=["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n"),MACROBLOCK_TYPE_TABLES=[null,MACROBLOCK_TYPE_I,MACROBLOCK_TYPE_P,MACROBLOCK_TYPE_B];